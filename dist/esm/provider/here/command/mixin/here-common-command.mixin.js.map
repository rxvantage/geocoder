{"version":3,"file":"here-common-command.mixin.js","sourceRoot":"","sources":["../../../../../../src/provider/here/command/mixin/here-common-command.mixin.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,2BAA2B,EAAE,MAAM,uBAAuB,CAAC;AACpE,OAAO,EAAE,YAAY,EAAE,MAAM,mBAAmB,CAAC;AACjD,OAAO,EAAE,uBAAuB,EAAE,MAAM,mBAAmB,CAAC;AAC5D,OAAO,EAAE,gBAAgB,EAAE,MAAM,YAAY,CAAC;AAM9C,MAAM,UAAU,sBAAsB,CAA6C,IAAW;IAC1F,MAAe,iBAAkB,SAAQ,IAAI;QAIzC,YAAsB,GAAG,IAAW;YAChC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YAEf,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;YAEvB,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;gBAC9B,MAAM,IAAI,2BAA2B,CAAC,6BAA6B,CAAC,CAAC;aACxE;QACL,CAAC;QAED,MAAM,CAAC,cAAc;YACjB,OAAO,YAAY,CAAC,YAAY,CAAC;QACrC,CAAC;QAES,KAAK,CAAC,gBAAgB,CAAC,SAA0C;YACvE,EAAE;QACN,CAAC;QAES,KAAK,CAAC,aAAa,CAAC,QAAyC,EAAE,KAAY;YACjF,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;gBAC3G,OAAO,EAAE,CAAC;aACb;YAED,IAAI,OAAO,GAAwB,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;YAEzE,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,GAAsB,EAAE,EAAE,CAAC,gBAAgB,CAAC,GAAG,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;YAC5F,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;gBACjB,OAAO,EAAE,CAAC;aACb;YAED,OAAO,OAAO,CAAC,GAAG,CACd,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,GAAsB,EAAoC,EAAE,CAAC,IAAI,uBAAuB,CAAC,GAAG,CAAC,CAAC,CACpH,CAAC;QACN,CAAC;KACJ;IAED,OAAO,iBAAiB,CAAC;AAC7B,CAAC","sourcesContent":["import type { AxiosResponse } from 'axios';\nimport { InvalidCredentialsException } from '../../../../exception';\nimport { AccuracyEnum } from '../../../../model';\nimport { HereLocationTransformer } from '../../transformer';\nimport { filterByAccuracy } from '../../util';\nimport type { AbstractCommand } from '../../../../command';\nimport type { Query } from '../../../../model';\nimport type { Constructor } from '../../../../types';\nimport type { HereOneResultType, HereResponseType } from '../../interface';\n\nexport function HereCommonCommandMixin<TBase extends Constructor<AbstractCommand>>(Base: TBase): TBase {\n    abstract class HereCommonCommand extends Base {\n        protected readonly appId: string;\n        protected readonly appCode: string;\n\n        protected constructor(...args: any[]) {\n            super(args[0]);\n\n            this.appId = args[1];\n            this.appCode = args[2];\n\n            if (!this.appId || !this.appCode) {\n                throw new InvalidCredentialsException('Invalid or missing api key.');\n            }\n        }\n\n        static getMaxAccuracy(): AccuracyEnum {\n            return AccuracyEnum.HOUSE_NUMBER;\n        }\n\n        protected async validateResponse(_response: AxiosResponse<HereResponseType>): Promise<void> {\n            //\n        }\n\n        protected async parseResponse(response: AxiosResponse<HereResponseType>, query: Query): Promise<HereLocationTransformer[]> {\n            if (!response.data.Response || !Array.isArray(response.data.Response.View) || !response.data.Response.View[0]) {\n                return [];\n            }\n\n            let results: HereOneResultType[] = response.data.Response.View[0].Result;\n\n            results = results.filter((raw: HereOneResultType) => filterByAccuracy(raw, query.accuracy));\n            if (!results.length) {\n                return [];\n            }\n\n            return Promise.all<HereLocationTransformer>(\n                results.map(async (raw: HereOneResultType): Promise<HereLocationTransformer> => new HereLocationTransformer(raw)),\n            );\n        }\n    }\n\n    return HereCommonCommand;\n}\n"]}